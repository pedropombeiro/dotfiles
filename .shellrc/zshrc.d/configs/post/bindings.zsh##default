#!/usr/bin/env zsh

bindkey ' ' magic-space # Auto-expand commands on pressing space

# Word navigation (must be set after zsh-vi-mode loads since it overrides keymaps)
for keymap in viins vicmd; do
  bindkey -M $keymap '^[[1;3C' forward-word       # Alt-Right (xterm)
  bindkey -M $keymap '^[[1;3D' backward-word      # Alt-Left (xterm)
  bindkey -M $keymap '^[^[[C' forward-word        # Alt-Right (ABC keyboard)
  bindkey -M $keymap '^[^[[D' backward-word       # Alt-Left (ABC keyboard)
  bindkey -M $keymap '^[^?' backward-kill-word    # Alt-Backspace
done

# Ctrl-O: Launch opencode (replaces current line and executes)
# Requires unsetting terminal's discard character which normally uses ^O
[[ -t 0 ]] && stty discard undef

opencode-widget() {
  zle kill-whole-line
  BUFFER="opencode"
  zle accept-line
}
zle -N opencode-widget
for keymap in viins vicmd; do
  bindkey -M $keymap '^O' opencode-widget
done
