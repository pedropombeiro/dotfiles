#!/usr/bin/env zsh

if command -v tmux >/dev/null; then
  export ITERM_ENABLE_SHELL_INTEGRATION_WITH_TMUX=YES
  export ZSH_TMUX_AUTOCONNECT=true
  export ZSH_TMUX_AUTOSTART=true
  export ZSH_TMUX_CONFIG="$HOME/.config/tmux/tmux.conf"
  export ZSH_TMUX_DEFAULT_SESSION_NAME="$(hostname)"
  export ZSH_TMUX_FIXTERM_WITH_256COLOR="$ZSH_TMUX_TERM"
  export ZSH_TMUX_ITERM2=false
  export ZSH_TMUX_UNICODE=true

  # Fix COLUMNS/LINES not being set properly in tmux (affects Claude Code statusline)
  if [[ -n "$TMUX" && ( -z "$COLUMNS" || "$COLUMNS" -eq 0 ) ]]; then
    export COLUMNS=$(tmux display-message -p '#{pane_width}')
    export LINES=$(tmux display-message -p '#{pane_height}')
  fi

  # Load tmux plugin via zinit - download individual files (required tmux.*.conf files)
  zinit ice as"null" id-as"OMZP::tmux-extra"
  zinit snippet https://github.com/ohmyzsh/ohmyzsh/raw/master/plugins/tmux/tmux.extra.conf
  # Now load the plugin, pointing _ZSH_TMUX_FIXED_CONFIG to the downloaded extra.conf
  zinit ice atload'export _ZSH_TMUX_FIXED_CONFIG="${XDG_DATA_HOME:-$HOME/.local/share}/zinit/snippets/OMZP::tmux-extra/tmux.extra.conf"'
  zinit snippet OMZP::tmux
fi
